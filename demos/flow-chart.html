<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <script src="../src/item/item.js"></script>
</head>
<body>
<div id="mountNode"></div>
<script src="https://gw.alipayobjects.com/os/antv/assets/lib/jquery-3.2.1.min.js"></script>
<script src="../build/g6.js"></script>
<script>
  $.getJSON('./assets/data/usa-president.json', data => {
    const presidents = {};
    const nodeMap = {
      birth_place: {},
      age: {},
      party: {},
      sgin: {}
    };
    const colors = ['#FD8C3D', '#D83F43', '#F7BED6', '#E487C7', '#46A848', '#D83F43', '#3B85BA', '#48335B', '#B7CDE9'];
    const nodes = [];
    const edges = [];
    const V_GAP = 30;
    // 数据预处理，整理出各个总统出生地，党派，年龄，星座的统计数据
    const params = ['birth_place','age', 'party', 'sgin' ];
    let lastParam = 'president';
    data.forEach(president => {
      presidents[president.president] = president;
      params.forEach(param => {
        let paramName = president[param];
        if (param === 'age') {
          paramName = Math.floor(((president.death_year || 2019) - president.birth_year) / 10, 10) * 10 + '';
          president.age = paramName;
        }
        if (!nodeMap[param][paramName]) {
          nodeMap[param][paramName] = 1;
        } else {
          nodeMap[param][paramName] += 1;
        }
        edges.push({ id: president[lastParam] + ':' + paramName, source: president[lastParam], target: paramName, shape: 'cubic-horizontal' });
        lastParam = param;
      });
     lastParam = 'president';
    });

    let lastHeight = V_GAP;
    Object.keys(nodeMap).forEach((nodeType, i) => {
      Object.keys(nodeMap[nodeType]).forEach(node => {
        const count = nodeMap[nodeType][node];
        nodes.push({
          id: node,
          x: i * 105 + 195,
          y: count * 5 / 2 + lastHeight,
          size: [50, height],
          style: { fill: colors[Math.round(Math.random() * 9)] },
          shape: 'rect',
          data: {
            count,
            type: nodeType
          },
          label: node,
          labelCfg: { position: 'top' }
        });
        lastHeight += height + V_GAP
      });
      lastHeight = V_GAP;
    });
    Object.keys(presidents).forEach(president => {
      const data = presidents[president];
      nodes.push({
        id: data.president,
        x: 80,
        y: lastHeight + 25,
        size: [50, 5],
        shape: 'rect',
        style: { fill: colors[Math.round(Math.random() * 9)] },
        data: data,
        label: data.president,
        labelCfg: { position: 'top' }
      });
      lastHeight += 30;
    });
    const graph = new G6.Graph({
      container: 'mountNode',
      width: 800,
      height: 800,
      nodeStyle: {
        default: { fill: '#ebebeb' }
      },
      edgeStyle: {
        default: { stroke: 'rgba(0, 0, 0, 0.2)' }
      }
    });
    graph.data({ nodes, edges });
    graph.render();
  });

</script>
</body>
</html>

