<!DOCTYPE html></script>
<html lang="en">
  
  <head>
    <meta charset="UTF-8">
    <title>data process</title>
  </head>
  <body>
    <div id="mountNode"></div>
    <script src="../build/g6.js"></script>
    <script src="./assets/jquery-3.2.1.min.js"></script>
    <script>
      $.getJSON('./assets/data/beijing-metro-source.json', data => {
        const nodes = [];
        const edges = [];
        let nodeId = 0;
        let edgeId = 0;

        // one line
        data.features.forEach(line => {
          let lineNodeId = 0;
          let lineEdgeId = 0;
          const coordinates = line.geometry.coordinates[0];
          const lineNodeNumber = coordinates.length;

          // edge 
          const edge = {
            id: edgeId + '',
            source: nodeId + '',
            target: (nodeId + 1) + '',
            class: line.properties.lineName,
            name: line.properties.lineName + ' ' + lineEdgeId
          };
          const controlPoints = [];

          // nodes and control points
          coordinates.forEach((coord, i) => {
            // end nodes
            if (i === 0 || i === lineNodeNumber - 1) {
              const node = {
                id: nodeId + '',
                x: coord[0],
                y: coord[1],
                class: line.properties.lineName,
                name: line.properties.lineName + ' ' + lineNodeId
              }
              nodes.push(node);
              nodeId++;
              lineNodeId++;
            } else { // control points
              controlPoints.push({
                x: coord[0],
                y: coord[1]
              })
            }
          });
          edge.controlPoints = controlPoints;
          edges.push(edge);
          lineEdgeId++;
          edgeId++;
        });
        const output = { nodes, edges };
        const json = JSON.stringify(output);
        console.log(json);
      });
    </script>
  </body>

</html>